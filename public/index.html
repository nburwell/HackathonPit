<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <title>Pit :: Hackathon</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <!-- Le styles -->
    <link href="css/bootstrap.css" rel="stylesheet">
    <style type="text/css">
      body {
        padding-top: 60px;
        padding-bottom: 40px;
      }
      .sidebar-nav {
        padding: 9px 0;
      }
      .selected {
        font-weight: bold;
        text-decoration: underline;
      }
    </style>
    <link href="css/bootstrap-responsive.css" rel="stylesheet">
    <script src='http://ajax.googleapis.com/ajax/libs/jquery/1.7.2/jquery.min.js'></script>

    <!-- Le HTML5 shim, for IE6-8 support of HTML5 elements -->
    <!--[if lt IE 9]>
      <script src="http://html5shim.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->

    <script type="text/javascript">

    var app;
    var socket_wrapper, socket_view;
	
	
	function sendIfEnter( textarea, evt )
	{	
	  if ( socket && evt.keyCode == '13' )
	  {
	    socket.send( $(textarea).val() );
	    $(textarea).val('');
	  }
	}

	function login( form )
	{
	  var user = $(form).find( 'input[name=name]' ).val();

	  if ( !user )
	  {
	    alert( "Username required!" );
	    return false;
	  }

	  app.lobby.login( user );
	  return false;
	}

function setup()
{
    app = new App.MainView({ el: $("#application") });

    app.model = { 
		hand : new App.Hand( {
	       cards : {
	          "Cocoa" : 4,
	          "Platinum" : 2,
	          "Gold" : 0,
	          "Cattle" : 1,
	          "Oil" : 2,
	          "Rice" : 0,
	          "Silver" : 0,
	          "Gas" : 0
	        } } ),
 		other_players : new App.OtherPlayers(  { 
			player_list: [ 
		        { "player_name" : "Frodo", 
		           "offer" : { "card_type" : "Platinum", "count" : 2, "trade_with" : "Bilbo" }                     
		        }, 
		        { "player_name" : "Sam", 
		           "offer" : { "card_type" : "Cocoa", "count" : 1, "trade_with" : null }                     
		        }, 
		        { "player_name" : "Merry", 
		           "offer" : null
		        }
			] } ),
		this_player : new App.ThisPlayer( { "name" : "Bilbo" } ),
		game : new App.Game( { "state" : "running" } )			
	};

    app.render();

    var router = new App.Router();
    Backbone.history.start();
//    Backbone.history.start({pushState : true});


  socket_wrapper = new SocketWrapper( { host : 'localhost', port : 8080 } );
  socket_wrapper.connect();
};


$( function() {
  setup();
} );

$(window).unload( function() {
  if ( socket )
  {
    socket.close();
  }
})

</script>

  </head>

  <body>

    <div class="navbar navbar-fixed-top">
      <div class="navbar-inner">
        <div class="container-fluid">
          <a class="btn btn-navbar" data-toggle="collapse" data-target=".nav-collapse">
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
          </a>
          <a class="brand" href="#">Pit. The Game. Realtime.</a>

          <div class="nav-collapse">
            <!-- TODO : this should be a backbone view -->
            <ul class="nav">
              <li class="lobby"><a href="/#">Lobby</a></li>
              <li class="game"><a href="/#game">Game</a></li>
              <li class="logout"><a href="/#logout">Logout</a></li>
            </ul>
          </div><!--/.nav-collapse -->
        </div>
      </div>
    </div>

    <div class="container-fluid">

      <div id="application">
        <div id="lobby" class="view"></div>
        <div id="game"  class="view"></div>
      </div>

      <hr>

      <footer>
        <p>&copy; 2012 Team Irish.  Created at RingRevenue Hackathon 2012.</p>
        <textarea onkeyup="sendIfEnter(this, event)" rows=3 col=30></textarea>
      </footer>

    </div><!--/.fluid-container-->


    <!-- TEMPLATES -->
    <script type="text/html" id="application-lobby">
      <h3>Lobby</h3>

      <form action="/#game" class="well form-search" onsubmit="login(this); return false">
        <input type="text" class="input-large" name="name">
        <button type="submit" class="btn">Join game</button>
      </form>
    </script>

    <script type="text/html" id="application-game">
      <div id='board'></div>
    </script>

    <script type="text/html" id="application-game-board">
      <div id='game-state'></div>
      <div id='trade-list'></div>
      <div id='this-player'></div>	  
      <div id='other-players'></div>	  
      <div id='hand'></div>
      <div id='offer-count'></div>
    </script>

    <script type="text/html" id="application-game-trade-list">
      trade list
    </script>

    <script type="text/html" id="application-game-trade">
      <div>
        <h4><%= player_name %></h4>
        <p><%= offer_type %>: <%= offer_count %></p>
      </div>
    </script>

    <script type="text/html" id="application-game-offer-count">
    </script>

	<script type="text/html" id="application-this-player">
	    <div class="this-player">
	      <%= name %>
	    </div>
	
	</script>

    <script type="text/html" id="application-game-offer-count-number">
      <div><%= number %></div>
    </script>

    <script type="text/html" id="application-game-hand">
    </script>

    <script type="text/html" id="application-game-card">
      <div class="card">
        <%= commodity %>
        <%= count %>
      </div>
    </script>
    <script type="text/html" id="application-game-state">
      <div class="game-state">
        <%= state %>
      </div>
    </script>
	
	

    <script type="text/html" id="application-other-players">
    </br>	
    </script>
    <script type="text/html" id="application-other-player">
	    <div class="other_player">
	      <%= name %> offers <%= offer_count %> cards.  ( wants to trade with <%= trade_with %>)
		  <br>
	    </div>
	    </br>	
    </script>


    <!-- Javascript resources
    ================================================== -->
    <!-- Placed at the end of the document so the pages load faster -->
    <script src="js/bootstrap.js"></script>
    <script src="js/backbone.js"></script>
    <script src="js/models/socket.js"></script>
    <script src="js/views/application.js"></script>
    <script src="js/views/game.js"></script>

  </body>
</html>
